<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Invisible Hand - Interactive Audio Investigation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            min-height: 100vh;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            padding: 25px 0;
            background: linear-gradient(135deg, #0f3460 0%, #e94560 100%);
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header h2 {
            font-size: 1.3rem;
            font-weight: normal;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .episode-info {
            font-size: 1rem;
            opacity: 0.8;
        }

        .disclaimer {
            grid-column: 1 / -1;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 0 0 20px 0;
            border-radius: 8px;
            border: 2px solid #ffd700;
            font-style: italic;
            font-size: 1rem;
            text-align: center;
        }

        .main-content {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .play-btn {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.400rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .skip-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.700rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            font-weight: bold;
        }

        .skip-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .progress-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 200px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: height 0.2s ease;
        }

        .progress-bar:hover {
            height: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.700rem;
            font-weight: 500;
            color: #ffd700;
        }

        .current-scene {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .scene-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .scene-description {
            color: #ccc;
            font-size: 1rem;
            line-height: 1.5;
        }

        .transcript-container {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .transcript-line {
            padding: 12px 15px;
            margin: 6px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .transcript-line:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: rgba(102, 126, 234, 0.5);
        }

        .transcript-line.current {
            background: rgba(102, 126, 234, 0.3);
            border-left-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .speaker-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.000rem;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .speaker-content {
            flex-grow: 1;
            min-width: 0;
        }

        .speaker-name {
            font-weight: bold;
            color: #ffd700;
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .speaker-title {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 6px;
            color: #ccc;
        }

        .speaker-text {
            font-size: 1rem;
            line-height: 1.4;
        }

        .sidebar-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .sidebar-section h3 {
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 1.1rem;
        }

        .keyboard-shortcuts {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .shortcut {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }

        .shortcut-key {
            background: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: bold;
            color: #667eea;
        }

        .info-item {
            margin: 10px 0;
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-weight: bold;
            color: #667eea;
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-indicator.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }
            
            .progress-container {
                min-width: 100%;
                order: -1;
            }
            
            .transcript-container {
                max-height: 300px;
            }
        }

        /* Custom scrollbar */
        .transcript-container::-webkit-scrollbar,
        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .transcript-container::-webkit-scrollbar-track,
        .main-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .transcript-container::-webkit-scrollbar-thumb,
        .main-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .transcript-container::-webkit-scrollbar-thumb:hover,
        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Smooth animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .playing .play-btn {
            animation: pulse 2s ease-in-out infinite;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="status-indicator" id="statusIndicator"></div>
    
    <div class="container">
        <div class="header">
            <h1>🎧 The Invisible Hand</h1>
            <h2>How AI Shaped Democracy's Darkest Hour</h2>
            <div class="episode-info">60 Minutes Investigation | Originally Broadcast March 12, 2045 | Winner: 2045 Peabody Award</div>
        </div>
        
        <div class="disclaimer">
            <strong>FICTIONAL CONTENT:</strong> This is entirely fictional content created for strategic analysis purposes. 
            All characters, companies, and events are imaginary. Any resemblance to real persons, organizations, or events is purely coincidental.
        </div>
        
        <div class="main-content">
            <div class="controls">
                <button class="skip-btn" id="skipBack" title="Skip back 15 seconds">-15</button>
                <button class="play-btn" id="playBtn" title="Play episode">▶</button>
                <button class="skip-btn" id="skipForward" title="Skip forward 30 seconds">+30</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" title="Click to seek">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">20:14</span>
                    </div>
                </div>
            </div>

            <div class="current-scene" id="currentScene">
                <div class="scene-title">Ready to Begin Investigation</div>
                <div class="scene-description">Click the play button to start "The Invisible Hand" - the story begins with Anderson Cooper III's opening sequence in the 60 Minutes studio...</div>
            </div>

            <div class="transcript-container" id="transcriptContainer">
                <!-- Transcript lines will be populated by JavaScript -->
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-section">
                <h3>⌨️ Controls</h3>
                <div class="keyboard-shortcuts">
                    <div class="shortcut">
                        <span>Play/Pause</span>
                        <span class="shortcut-key">SPACE</span>
                    </div>
                    <div class="shortcut">
                        <span>Skip Back 15s</span>
                        <span class="shortcut-key">←</span>
                    </div>
                    <div class="shortcut">
                        <span>Skip Forward 30s</span>
                        <span class="shortcut-key">→</span>
                    </div>
                    <div class="shortcut">
                        <span>Seek</span>
                        <span class="shortcut-key">Click Timeline</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>📻 Episode Info</h3>
                <div class="info-item">
                    <span class="info-label">Duration</span>
                    <span>20 minutes 14 seconds</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Correspondent</span>
                    <span>Anderson Cooper III</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Producer</span>
                    <span>60 Minutes Investigation Unit</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Awards</span>
                    <span>2045 Peabody Award</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Audio Quality</span>
                    <span>Best with headphones</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced documentary script with detailed character information
        const documentaryScript = [
            {
                speaker: "Anderson Cooper III",
                title: "60 Minutes Correspondent",
                avatar: "#c850c0",
                emoji: "🎤",
                gender: "male",
                scene: "60 Minutes studio with iconic stopwatch ticking in background",
                text: "Twenty years ago, in 2028, Americans went to the polls believing they had made informed decisions about their presidential candidate. What they didn't know was that the AI chatbot they trusted for political information—ChatMind, used by 180 million Americans—had been secretly programmed to favor one candidate over another.",
                duration: 18
            },
            {
                speaker: "Dr. Sarah Martinez",
                title: "Former AI Ethics Researcher, Stanford University",
                avatar: "#ee9ca7",
                emoji: "👩‍🔬",
                gender: "female",
                scene: "Stanford University office with AI research papers and computer monitors displaying bias detection algorithms",
                text: "The manipulation was incredibly sophisticated. They didn't change obvious facts—that would have been caught immediately. Instead, they altered the emphasis, the framing, the subtle cues that influence how people interpret information.",
                duration: 12
            },
            {
                speaker: "James Wellington",
                title: "Former Richardson Campaign Manager",
                avatar: "#4a90e2",
                emoji: "👔",
                gender: "male",
                scene: "Secure video conference call from undisclosed location with dramatic shadow lighting",
                text: "The President was obsessed with what he called 'the information war.' He'd seen how podcasts and social media influenced the previous election. But by 2028, AI chatbots were becoming the dominant way people got political information.",
                duration: 14
            },
            {
                speaker: "Anderson Cooper III",
                title: "60 Minutes Correspondent",
                avatar: "#c850c0",
                emoji: "🎤",
                gender: "male",
                scene: "Recreation of the Georgetown private club with atmospheric lighting and archive photos",
                text: "That dinner, held at a private club in Georgetown in February 2028, would change everything. According to Wellington, President Richardson made his request directly.",
                duration: 8
            },
            {
                speaker: "President Richardson",
                title: "Fictional Incumbent President (2025-2029)",
                avatar: "#f39c12",
                emoji: "🏛️",
                gender: "male",
                scene: "Dramatic recreation of the private Georgetown dinner with shadow silhouettes and whispered conversation",
                text: "Marcus, I need you to understand something. This isn't about politics anymore. It's about survival. The American people deserve leadership that understands the challenges we're facing. Sometimes democracy needs a guiding hand.",
                duration: 12
            },
            {
                speaker: "Marcus Steinberg",
                title: "CEO, Titan Ventures",
                avatar: "#8e44ad",
                emoji: "💼",
                gender: "male",
                scene: "High-end Silicon Valley office with panoramic city views, speaking directly to camera",
                text: "I want to be clear—we never discussed anything illegal. But the President made it clear that American democracy was at stake. He talked about foreign interference, about the need to protect our democratic institutions from manipulation.",
                duration: 15
            },
            {
                speaker: "Alex Chen",
                title: "Former Lead Engineer, Nexus AI",
                avatar: "#27ae60",
                emoji: "💻",
                gender: "female",
                scene: "Bustling San Francisco coffee shop, speaking in hushed tones with laptop showing code",
                text: "They called it 'Project Compass.' The idea was to subtly guide users toward what they called 'favorable interpretations' of political events. We were told it was to combat misinformation, but looking back... I realize what we were really doing.",
                duration: 16
            },
            {
                speaker: "Anderson Cooper III",
                title: "60 Minutes Correspondent",
                avatar: "#c850c0",
                emoji: "🎤",
                gender: "male",
                scene: "60 Minutes studio with technical diagrams and flowcharts showing AI manipulation methodology",
                text: "Project Compass operated in three phases. First, they identified key political topics and swing voter demographics. Then they crafted response templates that would nudge users toward supporting President Richardson. Finally, they deployed these changes gradually to avoid detection.",
                duration: 16
            },
            {
                speaker: "Dr. Sarah Martinez",
                title: "Former AI Ethics Researcher, Stanford University",
                avatar: "#ee9ca7",
                emoji: "👩‍🔬",
                gender: "female",
                scene: "Stanford laboratory with multiple screens showing AI bias detection software and statistical analysis",
                text: "The scariest part is how effective it was. Our analysis shows that ChatMind's biased responses may have influenced up to 15 million voters in key swing states. That's more than enough to change the outcome of a presidential election.",
                duration: 14
            },
            {
                speaker: "Michael Torres",
                title: "Former Campaign Manager, Opposition Campaign",
                avatar: "#e74c3c",
                emoji: "📊",
                gender: "male",
                scene: "Empty campaign headquarters with packed boxes and abandoned election materials",
                text: "Looking back, there were signs. Our internal polling showed we were ahead, but something felt... off. People seemed to know things that weren't quite right. Facts that had been subtly twisted. We assumed it was just the usual partisan media spin, but it was so much more systematic than that.",
                duration: 18
            },
            {
                speaker: "Anderson Cooper III",
                title: "60 Minutes Correspondent",
                avatar: "#c850c0",
                emoji: "🎤",
                gender: "male",
                scene: "60 Minutes studio with archive footage of 2028 election night coverage playing on monitors",
                text: "Election night 2028 shocked the political establishment. Despite leading in polls, the Democratic candidate lost by narrow margins in Pennsylvania, Michigan, and Wisconsin. The victory that seemed impossible had happened, and no one could explain why.",
                duration: 15
            },
            {
                speaker: "Michael Torres",
                title: "Former Campaign Manager, Opposition Campaign",
                avatar: "#e74c3c",
                emoji: "📊",
                gender: "male",
                scene: "Somber interview setting with campaign photos and victory signs visible in background",
                text: "I spent two years thinking we just ran a bad campaign. That maybe we missed something fundamental about what voters wanted. But knowing what I know now... we weren't just competing against another candidate. We were fighting against the very information environment that voters trusted.",
                duration: 16
            },
            {
                speaker: "Anderson Cooper III",
                title: "60 Minutes Correspondent",
                avatar: "#c850c0",
                emoji: "🎤",
                gender: "male",
                scene: "60 Minutes studio with split screen showing current AI assistants and 2028 ChatMind interface",
                text: "Today, new regulations require AI companies to disclose their training methods and submit to bias audits. But the question remains: in an age where artificial intelligence increasingly mediates our understanding of reality, how do we protect democracy from those who would manipulate it?",
                duration: 17
            },
            {
                speaker: "Michael Torres",
                title: "Former Campaign Manager, Opposition Campaign",
                avatar: "#e74c3c",
                emoji: "📊",
                gender: "male",
                scene: "Close-up interview shot with thoughtful, concerned expression",
                text: "The most chilling thing is that we assumed AI was neutral. We trusted it because it seemed objective, factual, removed from human bias. But that trust made us vulnerable in ways we never imagined. The question is: what other systems are we trusting that might not be as neutral as they appear?",
                duration: 20
            }
        ];

        // Audio control variables
        let isPlaying = false;
        let currentLineIndex = 0;
        let currentUtterance = null;
        let totalDuration = documentaryScript.reduce((sum, line) => sum + line.duration, 0);
        let startTime = null;

        // DOM elements
        const playBtn = document.getElementById('playBtn');
        const skipBack = document.getElementById('skipBack');
        const skipForward = document.getElementById('skipForward');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const currentSceneEl = document.getElementById('currentScene');
        const transcriptContainer = document.getElementById('transcriptContainer');
        const statusIndicator = document.getElementById('statusIndicator');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            totalTimeEl.textContent = formatTime(totalDuration);
            populateTranscript();
            
            // Wait for voices to load
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => {
                    showStatus('Voices loaded - Ready to play');
                };
            }
        });

        // Event listeners
        playBtn.addEventListener('click', togglePlay);
        skipBack.addEventListener('click', () => skipTime(-15));
        skipForward.addEventListener('click', () => skipTime(30));
        progressBar.addEventListener('click', seekTo);

        // Keyboard shortcuts - Apple Podcast style
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlay();
                    showStatus(isPlaying ? 'Paused' : 'Playing');
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    skipTime(-15);
                    showStatus('Skipped back 15 seconds');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    skipTime(30);
                    showStatus('Skipped forward 30 seconds');
                    break;
            }
        });

        function populateTranscript() {
            transcriptContainer.innerHTML = '';
            
            documentaryScript.forEach((line, index) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'transcript-line';
                lineEl.dataset.index = index;
                
                lineEl.innerHTML = `
                    <div class="speaker-avatar" style="background: ${line.avatar};">
                        ${line.emoji}
                    </div>
                    <div class="speaker-content">
                        <div class="speaker-name">${line.speaker}</div>
                        <div class="speaker-title">${line.title}</div>
                        <div class="speaker-text">${line.text}</div>
                    </div>
                `;
                
                lineEl.addEventListener('click', () => jumpToLine(index));
                transcriptContainer.appendChild(lineEl);
            });
        }

        function togglePlay() {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        }

        function play() {
            isPlaying = true;
            document.body.classList.add('playing');
            playBtn.textContent = '⏸';
            playBtn.title = 'Pause episode';
            startTime = Date.now();
            playCurrentLine();
            startProgressTracking();
            showStatus('Playing episode');
        }

        function pause() {
            isPlaying = false;
            document.body.classList.remove('playing');
            playBtn.textContent = '▶';
            playBtn.title = 'Play episode';
            
            if (currentUtterance) {
                speechSynthesis.cancel();
            }
            showStatus('Paused');
        }

        function playCurrentLine() {
            if (!isPlaying || currentLineIndex >= documentaryScript.length) {
                isPlaying = false;
                document.body.classList.remove('playing');
                playBtn.textContent = '▶';
                playBtn.title = 'Play episode';
                showStatus('Episode completed');
                return;
            }

            const line = documentaryScript[currentLineIndex];
            updateCurrentScene(line);
            highlightTranscriptLine(currentLineIndex);

            // Create enhanced speech synthesis
            currentUtterance = new SpeechSynthesisUtterance(line.text);
            
            // Configure voice based on gender with better voice selection
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
                let preferredVoice;
                
                if (line.gender === 'female') {
                    preferredVoice = voices.find(voice => 
                        voice.lang.includes('en') && 
                        (voice.name.toLowerCase().includes('female') || 
                         voice.name.toLowerCase().includes('samantha') ||
                         voice.name.toLowerCase().includes('kate') ||
                         voice.name.toLowerCase().includes('susan'))
                    ) || voices.find(voice => voice.lang.includes('en') && voice.name.includes('F'));
                } else {
                    preferredVoice = voices.find(voice => 
                        voice.lang.includes('en') && 
                        (voice.name.toLowerCase().includes('male') || 
                         voice.name.toLowerCase().includes('alex') ||
                         voice.name.toLowerCase().includes('daniel') ||
                         voice.name.toLowerCase().includes('david'))
                    ) || voices.find(voice => voice.lang.includes('en') && voice.name.includes('M'));
                }
                
                if (preferredVoice) {
                    currentUtterance.voice = preferredVoice;
                }
            }

            // Enhanced speech properties for better intonation
            currentUtterance.rate = 1.25; // 25% faster as requested
            currentUtterance.pitch = line.gender === 'female' ? 1.15 : 0.85;
            currentUtterance.volume = 0.9;

            // Character-specific adjustments for better differentiation
            if (line.speaker.includes('Cooper')) {
                currentUtterance.rate = 1.2; // Slightly slower for correspondent gravitas
                currentUtterance.pitch = 0.9;
            } else if (line.speaker.includes('President')) {
                currentUtterance.rate = 1.1; // Slower and deeper for authority
                currentUtterance.pitch = 0.7;
            } else if (line.speaker.includes('Martinez')) {
                currentUtterance.pitch = 1.2; // Higher for female academic
            }

            // Handle speech completion
            currentUtterance.onend = () => {
                if (isPlaying) {
                    currentLineIndex++;
                    setTimeout(playCurrentLine, 300); // Brief pause between speakers
                }
            };

            currentUtterance.onerror = (event) => {
                console.log('Speech synthesis error:', event);
                showStatus('Audio error - continuing');
                if (isPlaying) {
                    currentLineIndex++;
                    setTimeout(playCurrentLine, 1000);
                }
            };

            // Start speech
            try {
                speechSynthesis.speak(currentUtterance);
            } catch (error) {
                console.log('Speech synthesis not supported:', error);
                showStatus('Speech not supported - showing transcript only');
                // Continue showing transcript without audio
                setTimeout(() => {
                    if (isPlaying) {
                        currentLineIndex++;
                        playCurrentLine();
                    }
                }, line.duration * 1000);
            }
        }

        function skipTime(seconds) {
            let currentTime = documentaryScript.slice(0, currentLineIndex)
                .reduce((sum, line) => sum + line.duration, 0);
            
            currentTime += seconds;
            currentTime = Math.max(0, Math.min(currentTime, totalDuration));

            jumpToTime(currentTime);
        }

        function jumpToTime(targetTime) {
            let accumulatedTime = 0;
            let newIndex = 0;

            for (let i = 0; i < documentaryScript.length; i++) {
                if (accumulatedTime + documentaryScript[i].duration > targetTime) {
                    newIndex = i;
                    break;
                }
                accumulatedTime += documentaryScript[i].duration;
            }

            jumpToLine(newIndex);
        }

        function jumpToLine(index) {
            if (currentUtterance) {
                speechSynthesis.cancel();
            }

            currentLineIndex = Math.max(0, Math.min(index, documentaryScript.length - 1));
            startTime = Date.now() - (documentaryScript.slice(0, currentLineIndex).reduce((sum, line) => sum + line.duration, 0) * 1000);

            if (isPlaying) {
                playCurrentLine();
            } else {
                updateCurrentScene(documentaryScript[currentLineIndex]);
                highlightTranscriptLine(currentLineIndex);
            }
            
            showStatus(`Jumped to ${documentaryScript[currentLineIndex].speaker}`);
        }

        function seekTo(e) {
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            const targetTime = percent * totalDuration;
            jumpToTime(targetTime);
        }

        function updateCurrentScene(line) {
            currentSceneEl.innerHTML = `
                <div class="scene-title">${line.speaker}</div>
                <div class="scene-description">${line.scene}</div>
            `;
        }

        function highlightTranscriptLine(index) {
            document.querySelectorAll('.transcript-line').forEach((line, i) => {
                line.classList.toggle('current', i === index);
            });

            // Smart auto-scroll
            const currentLine = document.querySelector('.transcript-line.current');
            if (currentLine) {
                const container = transcriptContainer;
                const containerRect = container.getBoundingClientRect();
                const lineRect = currentLine.getBoundingClientRect();
                
                if (lineRect.top < containerRect.top || lineRect.bottom > containerRect.bottom) {
                    currentLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function startProgressTracking() {
            function updateProgress() {
                if (!isPlaying) return;
                
                const elapsed = documentaryScript.slice(0, currentLineIndex)
                    .reduce((sum, line) => sum + line.duration, 0);
                const percentage = Math.min((elapsed / totalDuration) * 100, 100);
                
                progressFill.style.width = `${percentage}%`;
                currentTimeEl.textContent = formatTime(elapsed);
                
                if (isPlaying) {
                    requestAnimationFrame(updateProgress);
                }
            }
            updateProgress();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function showStatus(message) {
            statusIndicator.textContent = message;
            statusIndicator.classList.add('show');
            setTimeout(() => {
                statusIndicator.classList.remove('show');
            }, 2000);
        }

        // Prevent accidental page navigation
        window.addEventListener('beforeunload', (e) => {
            if (isPlaying) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>